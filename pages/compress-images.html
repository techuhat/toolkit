<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compress Images Online (JPG/PNG/WebP) — ImageToolkit Pro</title>
  <meta name="description" content="Smart image compression in your browser — no data collection, no uploads, instant results." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://imagetoolkit.tech/pages/compress-images.html" />
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="icon" type="image/svg+xml" href="../public/favicon.svg" />
  <link rel="icon" type="image/x-icon" href="../public/favicon.ico" />
  <link rel="apple-touch-icon" href="../public/apple-touch-icon-180.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fimagetoolk2871back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
    <meta property="og:site_name" content="ImageToolkit Pro" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Compress Images Online (JPG/PNG/WebP) — ImageToolkit Pro" />
    <meta property="og:description" content="Smart image compression in your browser — no data collection, no uploads, instant results." />
    <meta property="og:url" content="https://imagetoolkit.tech/pages/compress-images.html" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:image" content="https://imagetoolkit.tech/public/og/og-default.svg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Compress Images Online (JPG/PNG/WebP) — ImageToolkit Pro" />
    <meta name="twitter:description" content="Smart image compression in your browser — no data collection, no uploads, instant results." />
  <meta name="twitter:image" content="https://imagetoolkit.tech/public/og/og-default.svg" />
    <meta name="theme-color" content="#0ea5e9" />
  <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Compress Images",
    "description": "Smart image compression in your browser — no data collection, no uploads, instant results.",
    "url": "https://imagetoolkit.tech/pages/compress-images.html",
    "inLanguage": "en",
    "publisher": {"@type": "Organization", "name": "ImageToolkit Pro"}
  }</script>
  <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://imagetoolkit.tech/"},
      {"@type": "ListItem", "position": 2, "name": "Compress Images", "item": "https://imagetoolkit.tech/pages/compress-images.html"}
    ]
  }</script>
</head>
<body class="bg-background text-text-primary font-inter antialiased">
  <a class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:bg-surface-light focus:text-white focus:p-2 focus:rounded" href="#main">Skip to content</a>
  <header class="sticky top-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" aria-label="Main">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-br from-primary to-accent rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gradient">ImageToolkit Pro</h1>
            <p class="text-xs text-text-secondary">Professional Processing</p>
          </div>
        </div>
        <div class="hidden md:flex items-center space-x-8">
          <a href="../index.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Home</a>
          <a href="compress-images.html" class="text-primary font-medium" aria-current="page">Compress</a>
          <a href="resize-images.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Resize</a>
          <a href="convert-images.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Convert</a>
          <a href="pdf_merge.html" class="text-text-secondary hover:text-primary transition-colors duration-300">PDF Tools</a>
          <a href="qr_code_studio.html" class="text-text-secondary hover:text-primary transition-colors duration-300">QR Studio</a>
          <a href="blog/index.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Blog</a>
        </div>
        <button class="md:hidden p-2 rounded-lg hover:bg-surface transition-colors duration-300" id="mobile-menu-btn">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
      <div class="md:hidden hidden" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1 bg-surface rounded-lg mt-2">
          <a href="../index.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-colors duration-300">Home</a>
          <a href="compress-images.html" class="block px-3 py-2 text-primary font-medium" aria-current="page">Compress</a>
          <a href="resize-images.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-colors duration-300">Resize</a>
          <a href="convert-images.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-colors duration-300">Convert</a>
          <a href="pdf_merge.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-colors duration-300">PDF Tools</a>
          <a href="qr_code_studio.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-colors duration-300">QR Studio</a>
          <a href="blog/index.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-colors duration-300">Blog</a>
        </div>
      </div>
    </nav>
  </header>

  <div class="flex min-h-screen">
    <main id="main" class="flex-1 p-6">
      <div class="mb-8">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center space-x-3">
            <div class="w-12 h-12 bg-gradient-to-br from-primary to-accent rounded-lg flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <div>
              <h1 class="text-3xl font-bold text-gradient">Compress Images</h1>
              <p class="text-text-secondary">Reduce size, keep quality. Batch supported.</p>
            </div>
          </div>
          <div class="hidden lg:flex items-center space-x-6 bg-surface/50 rounded-xl px-6 py-3 border border-border">
            <div class="text-center">
              <div class="text-2xl font-bold text-primary" id="processed-count">0</div>
              <div class="text-xs text-text-secondary">Processed Today</div>
            </div>
            <div class="w-px h-10 bg-border"></div>
            <div class="text-center">
              <div class="text-2xl font-bold text-accent" id="saved-space">0MB</div>
              <div class="text-xs text-text-secondary">Space Saved</div>
            </div>
            <div class="w-px h-10 bg-border"></div>
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-accent rounded-full animate-pulse"></div>
              <span class="text-sm text-text-secondary">Live</span>
            </div>
          </div>
        </div>
      </div>

      <div class="tool-panels">
        <div class="tool-panel active animate-fade-in" id="compress-panel" style="display:block;opacity:1">
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
            <div class="xl:col-span-1 space-y-6">
              <div class="drop-zone group" id="compress-drop-zone">
                <div class="flex flex-col items-center space-y-4">
                  <div class="w-16 h-16 bg-gradient-to-br from-primary/20 to-accent/20 rounded-full flex items-center justify-center">
                    <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                  </div>
                  <div class="text-center">
                    <h3 class="text-lg font-semibold mb-2">Smart Compression Engine</h3>
                    <p class="text-text-secondary text-sm">Advanced algorithms for optimal size reduction</p>
                    <p class="text-text-secondary text-xs mt-1">JPG, PNG, WebP • Up to 100MB each</p>
                  </div>
                  <button class="btn-primary">
                    <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Select Images
                  </button>
                </div>
                <input type="file" class="hidden" id="compress-file-input" multiple accept="image/*" />
              </div>

              <div class="card" id="compress-settings" style="display: none;">
                <h4 class="text-lg font-semibold mb-4 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                  </svg>
                  Compression Control
                </h4>
                <div class="space-y-6">
                  <div class="bg-surface-light rounded-lg p-4">
                    <label class="block text-sm font-medium mb-3 flex items-center justify-between">
                      <span>Quality Level</span>
                      <span class="text-primary font-bold" id="quality-value">80%</span>
                    </label>
                    <div class="relative">
                      <input type="range" id="quality-slider" min="10" max="100" value="80" class="w-full itp-slider" />
                      <div class="flex justify-between text-xs text-text-secondary mt-2">
                        <span class="flex items-center">
                          <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7"/>
                          </svg>
                          Smallest File
                        </span>
                        <span class="flex items-center">Best Quality
                          <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                          </svg>
                        </span>
                      </div>
                    </div>
                  </div>

                  <div class="bg-surface-light rounded-lg p-4">
                    <label class="block text-sm font-medium mb-3">Output Format</label>
                    <div class="space-y-2">
                      <label class="flex items-center p-3 rounded-lg bg-surface hover:bg-surface-light transition-colors cursor-pointer">
                        <input type="radio" name="compress-format" value="original" checked class="mr-3" />
                        <div class="flex-1">
                          <div class="font-medium">Keep Original</div>
                          <div class="text-xs text-text-secondary">Maintain current format</div>
                        </div>
                        <div class="px-2 py-1 bg-accent/20 text-accent text-xs rounded">Safe</div>
                      </label>
                      <label class="flex items-center p-3 rounded-lg bg-surface hover:bg-surface-light transition-colors cursor-pointer">
                        <input type="radio" name="compress-format" value="webp" class="mr-3" />
                        <div class="flex-1">
                          <div class="font-medium">WebP</div>
                          <div class="text-xs text-text-secondary">Best compression ratio</div>
                        </div>
                        <div class="px-2 py-1 bg-primary/20 text-primary text-xs rounded">Recommended</div>
                      </label>
                      <label class="flex items-center p-3 rounded-lg bg-surface hover:bg-surface-light transition-colors cursor-pointer">
                        <input type="radio" name="compress-format" value="jpeg" class="mr-3" />
                        <div class="flex-1">
                          <div class="font-medium">JPEG</div>
                          <div class="text-xs text-text-secondary">Universal compatibility</div>
                        </div>
                        <div class="px-2 py-1 bg-warning/20 text-warning text-xs rounded">Compatible</div>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="xl:col-span-2 space-y-6">
              <div class="card" id="compress-preview" style="display: none;">
                <h4 class="text-lg font-semibold mb-4 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                  Real-time Preview
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="space-y-3">
                    <div class="flex items-center justify-between">
                      <h5 class="font-medium text-text-secondary">Original</h5>
                      <div class="text-xs text-text-secondary" id="original-size">-</div>
                    </div>
                    <div class="relative aspect-video bg-surface-light rounded-lg overflow-hidden group">
                      <img id="original-preview" class="w-full h-full object-cover" alt="Original" loading="lazy" decoding="async" />
                      <div class="absolute top-2 left-2 bg-surface/90 rounded px-2 py-1 text-xs">Original</div>
                    </div>
                    <div class="text-xs text-text-secondary" id="original-dimensions">-</div>
                  </div>
                  <div class="space-y-3">
                    <div class="flex items-center justify-between">
                      <h5 class="font-medium text-text-secondary">Compressed</h5>
                      <div class="text-xs text-text-secondary" id="compressed-size">-</div>
                    </div>
                    <div class="relative aspect-video bg-surface-light rounded-lg overflow-hidden group">
                      <img id="compressed-preview" class="w-full h-full object-cover" alt="Compressed" loading="lazy" decoding="async" />
                      <div class="absolute top-2 left-2 bg-primary/90 rounded px-2 py-1 text-xs text-white">Optimized</div>
                    </div>
                    <div class="text-xs text-text-secondary" id="compressed-dimensions">-</div>
                  </div>
                </div>
                <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div class="bg-gradient-to-r from-accent/20 to-accent/30 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-accent" id="size-reduction">0%</div>
                    <div class="text-xs text-text-secondary">Size Reduction</div>
                  </div>
                  <div class="bg-gradient-to-r from-primary/20 to-primary/30 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-primary" id="quality-score">-</div>
                    <div class="text-xs text-text-secondary">Quality Score</div>
                  </div>
                  <div class="bg-gradient-to-r from-warning/20 to-warning/30 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-warning" id="format-type">-</div>
                    <div class="text-xs text-text-secondary">Output Format</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-8 flex justify-center">
        <button class="btn-primary px-12 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300" id="process-btn" style="display: none;">
          <svg class="w-6 h-6 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          Start Processing
        </button>
      </div>
    </main>

    <aside class="w-96 bg-surface/50 border-l border-border p-6 hidden xl:block">
      <div class="sticky top-24 space-y-8">
        <div>
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            Processing Queue
          </h3>
          <div class="space-y-3" id="processing-queue">
            <div class="text-center py-12">
              <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-primary/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
              </div>
              <p class="text-text-secondary font-medium">Ready to Process</p>
              <p class="text-text-secondary text-sm mt-1">Upload images to begin</p>
            </div>
          </div>
        </div>

        <div class="bg-primary/10 rounded-xl p-4 border border-primary/20">
          <div class="flex items-start space-x-3">
            <svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            <div>
              <h5 class="text-sm font-semibold text-primary mb-1">100% Privacy Protected</h5>
              <p class="text-xs text-text-secondary leading-relaxed">All processing happens locally in your browser. Your images never leave your device.</p>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <footer class="bg-surface/50 border-t border-border py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div class="col-span-1 md:col-span-2">
          <div class="flex items-center space-x-3 mb-4">
            <div class="w-10 h-10 bg-gradient-to-br from-primary to-accent rounded-lg flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gradient">ImageToolkit Pro</h3>
              <p class="text-sm text-text-secondary">Advanced Image Processing</p>
            </div>
          </div>
          <p class="text-text-secondary mb-4 max-w-md leading-relaxed">
            Professional-grade image processing with AI-powered enhancements. Transform your workflow with our privacy-first, browser-based tools.
          </p>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Quick Access</h4>
          <ul class="space-y-2">
            <li><a href="compress-images.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Compress Images</a></li>
            <li><a href="resize-images.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Resize Images</a></li>
            <li><a href="convert-images.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Convert Images</a></li>
            <li><a href="pdf_merge.html" class="text-text-secondary hover:text-primary transition-colors duration-300">PDF Tools</a></li>
            <li><a href="blog/index.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Blog</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-4">Resources</h4>
          <ul class="space-y-2">
            <li><a href="privacy-policy.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Privacy Policy</a></li>
            <li><a href="terms.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Terms & Conditions</a></li>
            <li><a href="disclaimer.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Disclaimer</a></li>
            <li><a href="cookies.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Cookie Policy</a></li>
            <li><a href="about.html" class="text-text-secondary hover:text-primary transition-colors duration-300">About Us</a></li>
            <li><a href="contact.html" class="text-text-secondary hover:text-primary transition-colors duration-300">Contact Us</a></li>
          </ul>
        </div>
      </div>
      <div class="border-t border-border mt-8 pt-8 flex flex-col md:flex-row justify-between items-center">
        <p class="text-text-secondary text-sm">© 2025 ImageToolkit Pro. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <script src="../js/nav.js"></script>
  <script>
  // Shared helpers and state (single tool page)
    let currentTool = 'compress';
    const selectedFilesByTool = { compress: [], resize: [], convert: [] };
  // Global tracker instance (used by downloadProcessedFile in activity-tracker.js)
  // Will be set on DOMContentLoaded

    function setSliderFill(slider) {
      if (!slider) return;
      const min = parseFloat(slider.min || '0');
      const max = parseFloat(slider.max || '100');
      const val = parseFloat(slider.value || String(min));
      const ratio = (val - min) / Math.max(1, (max - min));
      const w = slider.clientWidth || slider.offsetWidth || 0;
      const styles = getComputedStyle(slider);
      const thumbSizeRaw = styles.getPropertyValue('--thumb-size').trim();
      const thumbSize = thumbSizeRaw.endsWith('px') ? parseFloat(thumbSizeRaw) : 18;
      let percent = ratio * 100;
      if (w > 0) {
        const px = (ratio * (w - thumbSize)) + thumbSize / 2;
        percent = (px / w) * 100;
      }
      slider.style.setProperty('--valp', percent + '%');
    }

  function setupFileUpload(toolName) {
      const dropZone = document.getElementById(`${toolName}-drop-zone`);
      const fileInput = document.getElementById(`${toolName}-file-input`);
      const settings = document.getElementById(`${toolName}-settings`);
      const processBtn = document.getElementById('process-btn');
      if (!dropZone || !fileInput) return;
      const selectButton = dropZone.querySelector('button');
      if (selectButton) {
        selectButton.addEventListener('click', (e) => { e.stopPropagation(); fileInput.click(); });
      }
      fileInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        if (files.length > 0) {
          handleFiles(files, toolName);
          try { window.enhancedActivityTracker?.addToProcessingQueue(files, toolName, getProcessingOptions()); } catch {}
          showToast(`${files.length} file(s) selected successfully`, 'success');
        }
        e.target.value = '';
      });
      window.fileHandler.setupDragAndDrop(dropZone, {
        acceptedTypes: window.fileHandler.acceptedImageTypes,
        multiple: true,
        maxFiles: 50,
        clickToBrowse: false,
        onFilesAdded: (data) => {
          if (data.errors.length > 0) data.errors.forEach(error => showToast(error, 'error'));
          if (data.validFiles.length > 0) {
            handleFiles(data.validFiles, toolName);
            try { window.enhancedActivityTracker?.addToProcessingQueue(data.validFiles, toolName, getProcessingOptions()); } catch {}
            showToast(`${data.validFiles.length} file(s) added successfully`, 'success');
          }
        },
        onDragEnter: () => dropZone.classList.add('drag-over'),
        onDragLeave: () => dropZone.classList.remove('drag-over')
      });
    }

    async function handleFiles(files, toolName) {
      if (files.length === 0) return;
      const settings = document.getElementById(`${toolName}-settings`);
      const processBtn = document.getElementById('process-btn');
      if (settings) { settings.style.display = 'block'; settings.classList.add('animate-fade-in'); }
      if (processBtn) { processBtn.style.display = 'inline-flex'; processBtn.classList.add('animate-fade-in'); }
      selectedFilesByTool[toolName] = Array.from(files);
      const file = files[0];
      if (file.type.startsWith('image/')) {
        try {
          const imageInfo = await window.imageProcessor.getImageInfo(file);
          const reader = new FileReader();
          reader.onload = (e) => showCompressPreview(e.target.result, file, imageInfo);
          reader.readAsDataURL(file);
        } catch (error) { console.error('Error getting image info:', error); showToast('Error loading image preview', 'error'); }
      }
      addToQueueDisplay(files, toolName);
    }

    function addToQueueDisplay(files) {
      const queue = document.getElementById('processing-queue');
      if (!queue) return;
      queue.innerHTML = `
        <div class="text-center py-8">
          <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
            <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <p class="text-text-primary font-medium">${files.length} file(s) ready</p>
          <p class="text-text-secondary text-sm mt-1">Click 'Start Processing' to begin</p>
          <div class="mt-4 space-y-2">
            ${files.map(file => `<div class="text-xs text-text-secondary bg-surface/50 rounded px-3 py-2">${file.name} (${formatFileSize(file.size)})</div>`).join('')}
          </div>
        </div>`;
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024; const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    async function showCompressPreview(src, file, imageInfo) {
      const preview = document.getElementById('compress-preview');
      const originalPreview = document.getElementById('original-preview');
      const compressedPreview = document.getElementById('compressed-preview');
      const originalSize = document.getElementById('original-size');
      const compressedSize = document.getElementById('compressed-size');
      const originalDimensions = document.getElementById('original-dimensions');
      const compressedDimensions = document.getElementById('compressed-dimensions');
      const sizeReduction = document.getElementById('size-reduction');
      const qualityScore = document.getElementById('quality-score');
      const formatType = document.getElementById('format-type');
      if (preview) { preview.style.display = 'block'; preview.classList.add('animate-fade-in'); }
      if (originalPreview) originalPreview.src = src;
      if (originalSize) originalSize.textContent = formatFileSize(file.size);
      if (originalDimensions && imageInfo) originalDimensions.textContent = `${imageInfo.width} × ${imageInfo.height}`;
      try {
        const quality = (parseInt(document.getElementById('quality-slider')?.value || 80)) / 100;
        const format = document.querySelector('[name="compress-format"]:checked')?.value || 'webp';
        let outFormat = format;
        if (format === 'original') {
          const origFmt = (file.type.split('/')[1] || '').toLowerCase();
          outFormat = (origFmt === 'jpeg' || origFmt === 'jpg') ? 'jpeg' : 'webp';
        }
        const compressedBlob = await window.imageProcessor.compressImage(file, quality, outFormat);
        const compressedUrl = URL.createObjectURL(compressedBlob);
        if (compressedPreview) compressedPreview.src = compressedUrl;
        if (compressedSize) compressedSize.textContent = formatFileSize(compressedBlob.size);
        if (compressedDimensions && imageInfo) compressedDimensions.textContent = `${imageInfo.width} × ${imageInfo.height}`;
        const reduction = ((file.size - compressedBlob.size) / file.size * 100);
        if (sizeReduction) sizeReduction.textContent = `${reduction.toFixed(0)}%`;
        if (qualityScore) qualityScore.textContent = `${Math.round(quality * 100)}/100`;
        if (formatType) formatType.textContent = (outFormat || format).toUpperCase();
        setTimeout(() => URL.revokeObjectURL(compressedUrl), 30000);
      } catch (error) { console.error('Compression preview error:', error); showToast('Error generating compression preview', 'error'); }
    }

    function setupSliders() {
      const qualitySlider = document.getElementById('quality-slider');
      const qualityValue = document.getElementById('quality-value');
      if (qualitySlider && qualityValue) {
        qualitySlider.addEventListener('input', async (e) => {
          const value = e.target.value; qualityValue.textContent = value + '%'; setSliderFill(qualitySlider);
          const files = getCurrentFiles();
          if (files.length > 0 && files[0].type.startsWith('image/')) {
            try {
              const imageInfo = await window.imageProcessor.getImageInfo(files[0]);
              const reader = new FileReader();
              reader.onload = (event) => showCompressPreview(event.target.result, files[0], imageInfo);
              reader.readAsDataURL(files[0]);
            } catch (error) { console.error('Error updating preview:', error); }
          }
        });
        setSliderFill(qualitySlider);
        qualitySlider.dispatchEvent(new Event('input'));
      }
      window.addEventListener('resize', () => setSliderFill(qualitySlider));
    }

    function getCurrentFiles() { return selectedFilesByTool[currentTool] || []; }

    async function processFiles(files, options) {
      const results = [];
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        try {
          const processedBlob = await window.imageProcessor.compressImage(
            file,
            options.quality || 0.8,
            options.format === 'original' ? file.type.split('/')[1] : options.format || 'webp'
          );
          results.push({ success: true, original: file, processed: processedBlob, originalSize: file.size, processedSize: processedBlob.size, savedBytes: Math.max(0, file.size - processedBlob.size), filename: generateProcessedFilename(file, options) });
        } catch (error) {
          results.push({ success: false, original: file, error: error.message });
        }
      }
      return results;
    }

    function generateProcessedFilename(originalFile, options) {
      const name = originalFile.name.split('.')[0];
      const timestamp = Date.now();
      const extension = options.format === 'original' ? (originalFile.type.split('/')[1] || 'jpg') : options.format;
      return `${name}_compress_${timestamp}.${extension}`;
    }

    function addDownloadButtons(processedFiles) {
      const queue = document.getElementById('processing-queue');
      if (!queue) return; queue.innerHTML = '';
      processedFiles.forEach((result, index) => {
        const item = document.createElement('div');
        item.className = 'bg-surface rounded-lg p-4 border border-border animate-fade-in';
        const savedPercentage = ((result.savedBytes / result.originalSize) * 100).toFixed(1);
    item.innerHTML = `
          <div class=\"flex items-center space-x-3 mb-3\">
      <div class=\"w-10 h-10 bg-surface-light rounded-lg overflow-hidden\"><img src=\"${URL.createObjectURL(result.original)}\" class=\"w-full h-full object-cover\" alt=\"${result.original.name}\" loading=\"lazy\" decoding=\"async\"></div>
            <div class=\"flex-1 min-w-0\">
              <p class=\"text-sm font-medium truncate\">${result.original.name}</p>
              <p class=\"text-xs text-text-secondary\">${formatFileSize(result.originalSize)} → ${formatFileSize(result.processedSize)} <span class=\"text-accent\">(${savedPercentage}% reduction)</span></p>
            </div>
          </div>
          <button class=\"btn-primary text-xs py-2 px-4 w-full\">Download ${formatFileSize(result.processedSize)}</button>`;
        item.querySelector('button').addEventListener('click', () => {
          const link = document.createElement('a'); link.href = URL.createObjectURL(result.processed); link.download = result.filename; link.style.display = 'none'; document.body.appendChild(link); link.click(); document.body.removeChild(link); setTimeout(() => URL.revokeObjectURL(link.href), 100);
        });
        queue.appendChild(item);
      });
      if (processedFiles.length > 1) {
        const downloadAllBtn = document.createElement('button');
        downloadAllBtn.className = 'btn-primary w-full py-3 mt-4';
        downloadAllBtn.innerHTML = `<svg class=\"w-5 h-5 inline-block mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 10v6m0 0l-3-3m3 3l3-3m-6-8a9 9 0 110 18 9 9 0 010-18z\"/></svg>Download All as ZIP`;
        downloadAllBtn.addEventListener('click', async () => {
          try {
            const files = processedFiles.map(r => ({ blob: r.processed, filename: r.filename }));
            await downloadAsZip(files, `compressed_images_${Date.now()}.zip`);
            showToast('ZIP download started', 'success');
          } catch (error) { showToast('Error creating ZIP file', 'error'); }
        });
        queue.appendChild(downloadAllBtn);
      }
    }

    async function downloadAsZip(files, zipName) {
      if (!window.JSZip) { showToast('ZIP library not loaded', 'error'); return; }
      const zip = new JSZip(); files.forEach(({ blob, filename }) => zip.file(filename || 'file', blob));
      const zipBlob = await zip.generateAsync({ type: 'blob' });
      const link = document.createElement('a'); link.href = URL.createObjectURL(zipBlob); link.download = zipName; link.style.display = 'none'; document.body.appendChild(link); link.click(); document.body.removeChild(link); setTimeout(() => URL.revokeObjectURL(link.href), 100);
    }

    function getProcessingOptions() {
      return {
        quality: (parseInt(document.getElementById('quality-slider')?.value || 80)) / 100,
        format: document.querySelector('[name="compress-format"]:checked')?.value || 'webp'
      };
    }

    function showToast(message, type = 'info', duration = 4000) {
      const toast = document.createElement('div');
      toast.className = `toast fixed top-4 right-4 z-50 max-w-sm p-4 rounded-lg shadow-lg border transform translate-x-full transition-transform duration-300 ease-out ${type === 'success' ? 'bg-green-500 border-green-400 text-white' : ''} ${type === 'error' ? 'bg-red-500 border-red-400 text-white' : ''} ${type === 'warning' ? 'bg-yellow-500 border-yellow-400 text-black' : ''} ${type === 'info' ? 'bg-blue-500 border-blue-400 text-white' : ''}`;
      toast.innerHTML = `<div class=\"flex items-center justify-between\"><div class=\"font-medium\">${message}</div><button onclick=\"this.parentElement.parentElement.remove()\" class=\"ml-4 opacity-70 hover:opacity-100\"><svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg></button></div>`;
      document.body.appendChild(toast); setTimeout(() => { toast.style.transform = 'translateX(0)'; }, 100);
      setTimeout(() => { toast.style.transform = 'translateX(100%)'; setTimeout(() => toast.remove(), 300); }, duration);
    }

    function setupProcessButton() {
      const processBtn = document.getElementById('process-btn');
      processBtn?.addEventListener('click', async () => {
        const files = getCurrentFiles();
        const tracker = window.enhancedActivityTracker;

        if ((!tracker || tracker.processingQueue.length === 0) && files.length === 0) {
          showToast('No files to process', 'warning'); return;
        }

        // Ensure there are QUEUED items before starting
        if (tracker) {
          const hasQueued = tracker.processingQueue.some(it => it.status === 'queued');

          // If queue is empty and we have files selected, add them
          if (tracker.processingQueue.length === 0 && files.length > 0) {
            try { tracker.addToProcessingQueue(files, 'compress', getProcessingOptions()); } catch {}
          }
          // If queue exists but nothing is queued (all completed/failed), re-queue with current settings
          else if (!hasQueued) {
            const sourceFiles = files.length > 0 ? files : tracker.processingQueue.map(it => it.file);
            if (sourceFiles.length > 0) {
              try { tracker.addToProcessingQueue(sourceFiles, 'compress', getProcessingOptions()); } catch {}
            }
          }
        }

        processBtn.disabled = true; processBtn.innerHTML = `<svg class=\"w-5 h-5 inline-block mr-2 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/></svg>Processing...`;
        try {
          // Ensure queued items use current settings
          if (tracker) {
            const currentOpts = getProcessingOptions();
            tracker.processingQueue.forEach(it => {
              if (it.status === 'queued' && it.toolType === 'compress') {
                it.options = currentOpts;
              }
            });
          }

          const results = await tracker?.processQueue();
          const successful = (results || []).filter(r => r.status === 'completed' && r.result && r.result.blob);
          const successCount = successful.length;
          if (successCount > 0) {
            showToast(`${successCount} file(s) processed successfully!`, 'success');
            // Auto download: single file direct, multiple as ZIP
            if (successCount === 1) {
              window.fileHandler.downloadFile(successful[0].result.blob, successful[0].result.filename);
            } else {
              const files = successful.map(r => ({ blob: r.result.blob, filename: r.result.filename }));
              try { await downloadAsZip(files, `compressed_images_${Date.now()}.zip`); } catch {}
            }
          }
          tracker?.updateUI();
        } catch (error) { console.error('Processing error:', error); showToast(`Processing failed: ${error.message}`, 'error'); }
        finally { processBtn.disabled = false; processBtn.innerHTML = `<svg class=\"w-6 h-6 inline-block mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>Start Processing`; }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      window.imageProcessor = new ImageProcessor();
      window.fileHandler = new FileHandler();
      // Initialize tracker for counters and queue UI
      try { window.enhancedActivityTracker = new EnhancedActivityTracker(); window.enhancedActivityTracker.updateUI(); } catch {}
      setupFileUpload('compress');
      setupSliders();
      setupProcessButton();
    });

    // Minor styles for local panel state
    const style = document.createElement('style');
    style.textContent = `.tool-panel{display:block}.animate-fade-in{animation:fadeIn 0.3s ease-out forwards}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}`;
    document.head.appendChild(style);
  </script>

  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js" defer></script>
  <script src="../js/activity-tracker.js" defer></script>
  <script src="../js/file-handler.js" defer></script>
  <script src="../js/image-processor.js" defer></script>
  <script src="../js/pdf-processor.js" defer></script>
  <script src="../js/qr-generator.js" defer></script>
  <script src="../js/toolkit-app.js" defer></script>
  <script id="dhws-dataInjector" src="../public/dhws-data-injector.js" defer></script>
</body>
</html>




